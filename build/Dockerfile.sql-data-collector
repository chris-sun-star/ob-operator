# Build the sql-data-collector binary
FROM golang:1.24 AS builder

WORKDIR /workspace
# copy everything
COPY . .
# Build the binary
RUN make build-sql-data-collector

# Use a minimal base image
FROM openanolis/anolisos:8.8
WORKDIR /
# Copy the binary from the builder stage
COPY --from=builder /workspace/bin/sql-data-collector .
RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
# Run as a non-root user
USER 65534:65534

# Set the entrypoint
ENTRYPOINT ["/sql-data-collector"]